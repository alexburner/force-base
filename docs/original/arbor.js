!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.arbor=t()}}(function(){var define,module,exports;return function t(e,i,n){function s(r,a){if(!i[r]){if(!e[r]){var d="function"==typeof require&&require;if(!a&&d)return d(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+r+"'")}var p=i[r]={exports:{}};e[r][0].call(p.exports,function(t){var i=e[r][1][t];return s(i?i:t)},p,p.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,e){function i(t){var e,i=this,o=!1,r=null,a=[],d=null,p=null,u=null,l=null,c=!1;e="file:"===window.location.protocol&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1,o=void 0!==window.Worker&&!e,a.last=new Date,this.system=t,this.nodes={},this._lastPositions=null,this._lastFrametime=+Date.now(),this._lastBounds=null,this._currentRenderer=null,this.init=function(){var t=i.system.parameters();o?(n.trace("arbor.js/web-workers",t),d=setInterval(i.screenUpdate,t.timeout),r=new Worker("arbor.js"),r.onmessage=i.workerMsg,r.onerror=function(t){n.trace("physics:",t)},r.postMessage({type:"physics",physics:n.objmerge(t,{timeout:Math.ceil(t.timeout)})})):(n.trace("arbor.js/single-threaded",t),r=new s(t.dt,t.stiffness,t.repulsion,t.friction,i.system._updateGeometry,t.integrator),i.start())},this.graphChanged=function(t){o?r.postMessage({type:"changes",changes:t}):r._update(t)},this.particleModified=function(t,e){o?r.postMessage({type:"modify",id:t,mods:e}):r.modifyNode(t,e)},this.physicsModified=function(t){isNaN(t.timeout)||(o?(clearInterval(d),d=setInterval(i.screenUpdate,t.timeout)):(clearInterval(u),u=null)),o?r.postMessage({type:"sys",param:t}):r.modifyPhysics(t)},this.workerMsg=function(t){var e=t.data.type;"geometry"===e?i.workerUpdate(t.data):"stateChange"===e?i.system.isRunning="running"===t.data.value?!0:!1:void 0!==e&&n.trace("physics:",t.data)},this.workerUpdate=function(t){i._lastPositions=t,i._lastBounds=t.bounds},this.screenUpdate=function(){var t,e,n=(+Date.now(),!1);null!==i._lastPositions&&(i.system._updateGeometry(i._lastPositions),i._lastPositions=null,n=!0),i.system._updateBounds(i._lastBounds)&&(n=!0),i.system.isRunning&&n&&(e=i.system.renderer,void 0!==e&&(e!==p&&(e.init(i.system),p=e),e.redraw(),t=a.last,a.last=new Date,a.push(a.last-t),a.length>50&&a.shift()))},i.physicsUpdate=function(){var t,e,n,s,o;r.tick(),t=i.system._updateBounds(),e=i.system.renderer,o=new Date,void 0!==e&&(e!==p&&(e.init(i.system),p=e),e.redraw({timestamp:o})),n=a.last,a.last=o,a.push(a.last-n),a.length>50&&a.shift(),s=r.systemEnergy(),(s.mean+s.max)/2<.05?(null===l&&(l=+Date.now()),+Date.now()-l>1e3?(clearInterval(u),u=null,i.system.isRunning=!1):i.system.isRunning=!1):l=null},this.fps=function(t){var e,n,s,o;for(void 0!==t&&(n=1e3/Math.max(1,targetFps),i.physicsModified({timeout:n})),e=0,j=a.length;j>e;e++)o+=a[e];return s=o/Math.max(1,a.length),isNaN(s)?0:Math.round(1e3/s)},this.start=function(){null===u&&(c=!1,o?r.postMessage({type:"start"}):(i.system.isRunning=!0,l=null,u=setInterval(i.physicsUpdate,i.system.parameters().timeout)))},this.stop=function(){c=!0,o?r.postMessage({type:"stop"}):(i.system.isRunning=!1,null!==u&&(clearInterval(u),u=null))},this.init()}var n=t("./Util"),s=t("./physics/Physics");e.exports=i},{"./Util":2,"./physics/Physics":6}],2:[function(_dereq_,module,exports){var Util;Util={trace:function(msg){var len=arguments.length,i,args=[];for(i=0;len>i;i++)args.push("arguments["+i+"]");eval("console.log("+args.join(",")+")")},objcopy:function(t){var e,i,n;if(void 0===t)return void 0;if(null===t)return null;if(t.parentNode)return t;switch(typeof t){case"string":return t.substring(0);case"number":return t+0;case"boolean":return t===!0}i=Array.isArray(t)?[]:{};for(e in t)n=t[e],i[e]=Util.objcopy(n);return i},objmerge:function(t,e){var i,n;t=t||{},e=e||{},i=Util.objcopy(t);for(n in e)i[n]=e[n];return i},arborPath:function(){var t=$("script").map(function(){var t=$(this).attr("src");if(t)return t.match(/arbor[^\/\.]*.js|dev.js/)?t.match(/.*\//)||"/":void 0});return t.length>0?t[0]:null}},module.exports=Util},{}],3:[function(t,e){"use strict";{var i=t("./Kernel"),n=t("./physics/ParticleSystem"),s=t("./physics/PhysicsWorker");t("./physics/atoms/Point"),t("./Util")}e.exports={Kernel:i,physics:new s,ParticleSystem:n}},{"./Kernel":1,"./Util":2,"./physics/ParticleSystem":5,"./physics/PhysicsWorker":7,"./physics/atoms/Point":11}],4:[function(t,e){function i(){var t=this,e=[],i=0,s=null,o=.5;this.init=function(e,n,r){o=r,i=0,s=t._newBranch(),s.origin=e,s.size=n.subtract(e)},this.insert=function(e){for(var i=s,o=[e];o.length;){var r=o.shift(),a=r._m||r.m,d=t._whichQuad(r,i);if(void 0===i[d])i[d]=r,i.mass+=a,i.p=i.p?i.p.add(r.p.multiply(a)):r.p.multiply(a);else if("origin"in i[d])i.mass+=a,i.p=i.p?i.p.add(r.p.multiply(a)):r.p.multiply(a),i=i[d],o.unshift(r);else{var p=i.size.divide(2);if(0===p.magnitude())return;var u=new n(i.origin);"s"===d[0]&&(u.y+=p.y),"e"===d[1]&&(u.x+=p.x);var l=i[d];if(i[d]=t._newBranch(),i[d].origin=u,i[d].size=p,i.mass=a,i.p=r.p.multiply(a),i=i[d],l.p.x===r.p.x&&l.p.y===r.p.y){var c=.08*p.x,f=.08*p.y;l.p.x=Math.min(u.x+p.x,Math.max(u.x,l.p.x-c/2+Math.random()*c)),l.p.y=Math.min(u.y+p.y,Math.max(u.y,l.p.y-f/2+Math.random()*f))}o.push(l),o.unshift(r)}}},this.applyForces=function(t,e){for(var i,r,a,d=[s];d.length>0;)if(node=d.shift(),void 0!==node&&t!==node)if("f"in node)i=t.p.subtract(node.p),r=Math.max(1,i.magnitude()),a=(i.magnitude()>0?i:n.random(1)).normalize(),t.applyForce(a.multiply(e*(node._m||node.m)).divide(r*r));else{var p=t.p.subtract(node.p.divide(node.mass)).magnitude(),u=Math.sqrt(node.size.x*node.size.y);u/p>o?(d.push(node.ne),d.push(node.nw),d.push(node.se),d.push(node.sw)):(i=t.p.subtract(node.p.divide(node.mass)),r=Math.max(1,i.magnitude()),a=(i.magnitude()>0?i:n.random(1)).normalize(),t.applyForce(a.multiply(e*node.mass).divide(r*r)))}},this._whichQuad=function(t,e){if(t.p.exploded())return null;var i=t.p.subtract(e.origin),n=e.size.divide(2);return i.y<n.y?i.x<n.x?"nw":"ne":i.x<n.x?"sw":"se"},this._newBranch=function(){var t;return e[i]?(t=e[i],t.ne=t.nw=t.se=t.sw=void 0,t.mass=0,delete t.p):(t={origin:null,size:null,nw:void 0,ne:void 0,sw:void 0,se:void 0,mass:0},e[i]=t),i++,t}}var n=t("./atoms/Point");e.exports=i},{"./atoms/Point":11}],5:[function(t,i){function n(t,i,n,d,p,u,l,c){var f,h,y,m,g,v=this,x=[],_=null,b=0,w=null,N=.04,P=[20,20,20,20],M=null,k=null;t===Object(t)&&(f=t,n=f.friction,t=f.repulsion,p=f.fps,u=f.dt,i=f.stiffness,d=f.gravity,l=f.precision,c=f.integrator),"verlet"!==c&&"euler"!==c&&(c="verlet"),n=isNaN(n)?.5:n,t=isNaN(t)?1e3:t,p=isNaN(p)?55:p,i=isNaN(i)?600:i,u=isNaN(u)?.02:u,l=isNaN(l)?.6:l,d=d===!0,h=void 0!==p?1e3/p:20,y={integrator:c,repulsion:t,stiffness:i,friction:n,dt:u,gravity:d,precision:l,timeout:h},g={renderer:null,nodes:{},edges:{},adjacency:{},names:{},kernel:null},this.isRunning=!1,this.parameters=function(t){var e;if(void 0!==t){isNaN(t.precision)||(t.precision=Math.max(0,Math.min(1,t.precision)));for(e in parameters)void 0!==t[e]&&(y[e]=t[e]);g.kernel.physicsModified(t)}return y},this.fps=function(t){return void 0===t?g.kernel.fps():void v.parameters({timeout:1e3/(t||50)})},this.start=function(){g.kernel.start()},this.stop=function(){g.kernel.stop()},this.addNode=function(t,e){var i,n,s,r,a=g.names[t];return e=e||{},a?(a.data=e,a):void 0!==t?(i=void 0!==e.x?e.x:null,n=void 0!==e.y?e.y:null,s=e.fixed?1:0,r=new o(e),r.name=t,g.names[t]=r,g.nodes[r._id]=r,x.push({t:"addNode",id:r._id,m:r.mass,x:i,y:n,f:s}),v._notify(),r):void 0},this.pruneNode=function(t){var i,n=v.getNode(t);void 0!==g.nodes[n._id]&&(delete g.nodes[n._id],delete g.names[n.name]);for(i in g.edges)e=g.edges[i],(e.source._id===n._id||e.target._id===n._id)&&v.pruneEdge(e);x.push({t:"dropNode",id:n._id}),v._notify()},this.getNode=function(t){return void 0!==t._id?t:"string"==typeof t||"number"==typeof t?g.names[t]:void 0},this.eachNode=function(t){var e,i,n;for(e in g.nodes)n=g.nodes[e],null!=n._p.x&&null!=n._p.y&&(i=null!==w?v.toScreen(n._p):n._p,t.call(v,n,i))},this.addEdge=function(t,e,i){var n,s,o,a,d,p;if(t=v.getNode(t)||v.addNode(t),e=v.getNode(e)||v.addNode(e),i=i||{},n=new r(t,e,i),s=t._id,o=e._id,g.adjacency[s]=g.adjacency[s]||{},g.adjacency[s][o]=g.adjacency[s][o]||[],p=g.adjacency[s][o].length>0,!p)return g.edges[n._id]=n,g.adjacency[s][o].push(n),d=void 0!==n.length?n.length:1,x.push({t:"addSpring",id:n._id,fm:s,to:o,l:d}),v._notify(),n;for(a in n.data)g.adjacency[s][o].data[a]=n.data[a]},this.pruneEdge=function(t){var e,i,n,s;x.push({t:"dropSpring",id:t._id}),delete g.edges[t._id];for(e in g.adjacency)for(i in g.adjacency[e])for(s=g.adjacency[e][i],n=s.length-1;n>=0;n--)g.adjacency[e][i][n]._id===t._id&&g.adjacency[e][i].splice(n,1);v._notify()},this.getEdges=function(t,e){return t=v.getNode(t),e=v.getNode(e),t&&e?void 0!==g.adjacency[t._id]&&void 0!==g.adjacency[t._id][e._id]?g.adjacency[t._id][e._id]:[]:[]},this.getEdgesFrom=function(t){var e,i,n=[];if(t=v.getNode(t),!t)return[];if(void 0!==g.adjacency[t._id]){for(i in g.adjacency[t._id])e=g.adjacency[t._id][i],n=n.concat(e);return n}return[]},this.getEdgesTo=function(t){var e,i,n=[];if(t=v.getNode(t),!t)return[];for(e in g.edges)i=g.edges[e],i.target===t&&n.push(i);return n},this.eachEdge=function(t){var e,i,n,s;for(e in g.edges)i=g.edges[e],n=g.nodes[i.source._id]._p,s=g.nodes[i.target._id]._p,null!=n.x&&null!=s.x&&(null!==w&&(n=v.toScreen(n),s=v.toScreen(s)),n&&s&&t.call(v,i,n,s))},this.prune=function(t){var e,i,n;if(e={dropped:{nodes:[],edges:[]}},void 0===t)for(n in g.nodes)i=g.nodes[n],e.dropped.nodes.push(i),v.pruneNode(i);else v.eachNode(function(i){var n=t.call(v,i,{from:v.getEdgesFrom(i),to:v.getEdgesTo(i)});n&&(e.dropped.nodes.push(i),v.pruneNode(i))});return e},this.graft=function(t){var e,i,n,s,o,r,a,d,p,u;if(e={added:{nodes:[],edges:[]}},t.nodes)for(i in t.nodes)u=t.nodes[i],o=v.getNode(i),o?o.data=u:e.added.nodes.push(v.addNode(i,u)),g.kernel.start();if(t.edges)for(n in t.edges){dsts=t.edges[n],a=v.getNode(n),a||e.added.nodes.push(v.addNode(n,{}));for(s in dsts)p=dsts[s],d=v.getNode(s),d||e.added.nodes.push(v.addNode(s,{})),r=v.getEdges(n,s),r.length>0?r[0].data=p:e.added.edges.push(v.addEdge(n,s,p))}return e},this.merge=function(t){var e,i,n,s,o;e={added:{nodes:[],edges:[]},dropped:{nodes:[],edges:[]}};for(s in g.edges)o=g.edges[s],(void 0===t.edges[o.source.name]||void 0===t.edges[o.source.name][o.target.name])&&(v.pruneEdge(o),e.dropped.edges.push(o));return n=v.prune(function(i){return void 0===t.nodes[i.name]?(e.dropped.nodes.push(i),!0):void 0}),i=v.graft(t),e.added.nodes=e.added.nodes.concat(i.added.nodes),e.added.edges=e.added.edges.concat(i.added.edges),e.dropped.nodes=e.dropped.nodes.concat(n.dropped.nodes),e.dropped.edges=e.dropped.edges.concat(n.dropped.edges),e},this._updateGeometry=function(t){var e,i,n,s;if(void 0!=t&&(e=t.geometry,i=t.epoch<b,m=t.energy,void 0!==e))for(n=0,j=e.length/3;j>n;n++)s=e[3*n],i&&void 0==g.nodes[s]||(g.nodes[s]._p.x=e[3*n+1],g.nodes[s]._p.y=e[3*n+2])},this.screen=function(t){return void 0===t?{size:w?Util.objcopy(w):void 0,padding:P.concat(),step:N}:(void 0!==t.size&&v.screenSize(t.size.width,t.size.height),isNaN(t.step)||v.screenStep(t.step),void(void 0!==t.padding&&v.screenPadding(t.padding)))},this.screenSize=function(t,e){w={width:t,height:e},v._updateBounds()},this.screenPadding=function(t,e,i,n){var s,o,r;trbl=Array.isArray(t)?t:[t,e,i,n],s=trbl[0],o=trbl[1],r=trbl[2],void 0===o?trbl=[s,s,s,s]:void 0===r&&(trbl=[s,o,s,o]),P=trbl},this.screenStep=function(t){N=t},this.toScreen=function(t){var e,i,n;if(M&&w)return _padding=P||[0,0,0,0],e=M.bottomright.subtract(M.topleft),i=_padding[3]+t.subtract(M.topleft).divide(e.x).x*(w.width-(_padding[1]+_padding[3])),n=_padding[0]+t.subtract(M.topleft).divide(e.y).y*(w.height-(_padding[0]+_padding[2])),new a(i,n)},this.fromScreen=function(t){var e,i,n;if(M&&w)return _padding=P||[0,0,0,0],e=M.bottomright.subtract(M.topleft),i=(t.x-_padding[3])/(w.width-(_padding[1]+_padding[3]))*e.x+M.topleft.x,n=(t.y-_padding[0])/(w.height-(_padding[0]+_padding[2]))*e.y+M.topleft.y,new a(i,n)},this._updateBounds=function(t){var e,i,n,s,o,r,d=4;if(null!==w)return k=t?t:v.bounds(),e=new a(k.bottomright.x,k.bottomright.y),i=new a(k.topleft.x,k.topleft.y),n=e.subtract(i),s=i.add(n.divide(2)),r=new a(Math.max(n.x,d),Math.max(n.y,d)),k.topleft=s.subtract(r.divide(2)),k.bottomright=s.add(r.divide(2)),M?(o=N,_newBounds={bottomright:M.bottomright.add(k.bottomright.subtract(M.bottomright).multiply(o)),topleft:M.topleft.add(k.topleft.subtract(M.topleft).multiply(o))},diff=new a(M.topleft.subtract(_newBounds.topleft).magnitude(),M.bottomright.subtract(_newBounds.bottomright).magnitude()),diff.x*w.width>1||diff.y*w.height>1?(M=_newBounds,!0):!1):0===Object.keys(g.nodes).length?!1:(M=k,!0)},this.energy=function(){return m},this.bounds=function(){var t,e,i,n=null,s=null;for(t in g.nodes)if(i=g.nodes[t],null!==n){if(e=i._p,null===e.x||null===e.y)return;e.x>n.x&&(n.x=e.x),e.y>n.y&&(n.y=e.y),e.x<s.x&&(s.x=e.x),e.y<s.y&&(s.y=e.y)}else n=new a(i._p),s=new a(i._p);return n&&s?{bottomright:n,topleft:s}:{topleft:new a(-1,-1),bottomright:new a(1,1)}},this.nearest=function(t){var e,i,n,s,o={node:null,point:null,distance:null};null!==w&&(t=v.fromScreen(t));for(e in g.nodes)s=g.nodes[e],i=s._p,null!==i.x&&null!==i.y&&(n=i.subtract(t).magnitude(),(null===o.distance||n<o.distance)&&(o={node:s,point:i,distance:n},null!==w&&(o.screenPoint=v.toScreen(i))));return o.node?(null!==w&&(o.distance=v.toScreen(o.node.p).subtract(v.toScreen(t)).magnitude()),o):null},this._notify=function(){null===_?b++:clearTimeout(_),v._synchronize()},this._synchronize=function(){x.length>0&&(g.kernel.graphChanged(x),x=[],_=null)},g.kernel=new s(this),Object.defineProperty(o.prototype,"p",{get:function(){var t=this,e={};return Object.defineProperty(e,"x",{get:function(){return t._p.x},set:function(e){g.kernel.particleModified(t._id,{x:e})}}),Object.defineProperty(e,"y",{get:function(){return t._p.y},set:function(e){g.kernel.particleModified(t._id,{y:e})}}),e.__proto__=a.prototype,e},set:function(t){this._p.x=t.x,this._p.y=t.y,g.kernel.particleModified(this._id,{x:t.x,y:t.y})}}),Object.defineProperty(o.prototype,"mass",{get:function(){return this._mass},set:function(t){this._mass=t,g.kernel.particleModified(this._id,{m:t})}}),Object.defineProperty(o.prototype,"dampingFactor",{get:function(){return this._dampingFactor},set:function(t){this._dampingFactor=t,g.kernel.particleModified(this._id,{d:t})}}),Object.defineProperty(o.prototype,"tempMass",{set:function(t){console.log("tempMass set",t),g.kernel.particleModified(this._id,{_m:t})}}),Object.defineProperty(o.prototype,"fixed",{get:function(){return this._fixed},set:function(t){this._fixed=t,g.kernel.particleModified(this._id,{f:t?1:0})}})}var s=t("../Kernel"),o=t("./atoms/Node"),r=t("./atoms/Edge"),a=t("./atoms/Point");i.exports=n},{"../Kernel":1,"./atoms/Edge":8,"./atoms/Node":9,"./atoms/Point":11}],6:[function(t,e){var i=t("./atoms/Point"),n=t("./atoms/Particle"),s=t("./BarnesHutTree"),o=t("./atoms/Spring"),r=function(t,e,r,a,d,p){var u=this,l=new s,c={particles:{},springs:{}},f={particles:{}},h=[],y=[],m=0,g={sum:0,max:0,mean:0},v={topleft:new i(-1,-1),bottomright:new i(1,1)};this.integrator="euler"===p?"euler":"verlet",this.stiffness=void 0!==e?e:1e3,this.repulsion=void 0!==r?r:600,this.friction=void 0!==a?a:.3,this.gravity=!1,this.dt=void 0!==t?t:.02,this.theta=.4,this.modifyPhysics=function(t){var e;e=["stiffness","repulsion","friction","gravity","dt","precision","integrator"],e.forEach(function(e){var i;if(void 0!==t[e]){if("precision"===e)return void(u.theta=1-t[e]);u[e]=t[e],"stiffness"===e&&(i=t[e],c.springs.forEach(function(t){t.k=i}))}})},this.addNode=function(t){var e,s,o,r=t.id,a=t.m,d=t.d;e=v.bottomright.x-v.topleft.x,s=v.bottomright.y-v.topleft.y,o=new i(null!=t.x?t.x:v.topleft.x+e*Math.random(),null!=t.y?t.y:v.topleft.y+s*Math.random()),c.particles[r]=new n(o,a,d),c.particles[r].connections=0,c.particles[r].fixed=1===t.f,f.particles[r]=c.particles[r],h.push(c.particles[r])},this.dropNode=function(t){var e=t.id,i=c.particles[e],n=h.indexOf(i);n>-1&&h.splice(n,1),delete c.particles[e],delete f.particles[e]},this.modifyNode=function(t,e){var i;t in c.particles&&(i=c.particles[t],"x"in e&&(i.p.x=e.x),"y"in e&&(i.p.y=e.y),"m"in e&&(i.m=e.m),"f"in e&&(i.fixed=1===e.f),"_m"in e&&(void 0===i._m&&(i._m=i.m),i.m=e._m),"d"in e&&(i.d=e.d))},this.addSpring=function(t){var e=t.id,i=t.l,n=c.particles[t.fm],s=c.particles[t.to];void 0!==n&&void 0!==s&&(c.springs[e]=new o(n,s,i,u.stiffness),y.push(c.springs[e]),n.connections++,s.connections++,delete f.particles[t.fm],delete f.particles[t.to])},this.dropSpring=function(t){var e=t.id,i=c.springs[e],n=y.indexOf(i);i.point1.connections--,i.point2.connections--,n>-1&&y.splice(n,1),delete c.springs[e]},this._update=function(t){var e,i;m++;for(e in t)i=t[e],i.t in u&&u[i.t](i);return m},this.tick=function(){u.tendParticles(),"euler"===u.integrator?(u.updateForces(),u.updateVelocity(u.dt),u.updatePosition(u.dt)):(u.updateForces(),u.cacheForces(),u.updatePosition(u.dt),u.updateForces(),u.updateVelocity(u.dt)),u.tock()},this.tock=function(){var t,e,i=[];for(t in c.particles)e=c.particles[t],i.push(t),i.push(e.p.x),i.push(e.p.y);d&&d({geometry:i,epoch:m,energy:g,bounds:v})},this.tendParticles=function(){var t,e;for(t in c.particles)e=c.particles[t],void 0!==e._m&&(Math.abs(e.m-e._m)<1?(e.m=e._m,delete e._m):e.m*=.98),e.v.x=e.v.y=0},this.updateForces=function(){u.repulsion>0&&(u.theta>0?u.applyBarnesHutRepulsion():u.applyBruteForceRepulsion()),u.stiffness>0&&u.applySprings(),u.applyCenterDrift(),u.gravity&&u.applyCenterGravity()},this.cacheForces=function(){var t,e;for(t in c.particles)e=c.particles[t],e._F=e.f},this.applyBruteForceRepulsion=function(){var t,e,n,s,o,r,a;for(t in c.particles){o=c.particles[t];for(r in c.particles)a=c.particles[r],o!==a&&(e=o.p.subtract(a.p),n=Math.max(1,e.magnitude()),s=(e.magnitude()>0?e:i.random(1)).normalize(),o.applyForce(s.multiply(u.repulsion*(a._m||a.m)*.5).divide(n*n*.5)),a.applyForce(s.multiply(u.repulsion*(o._m||o.m)*.5).divide(n*n*-.5)))}},this.applyBarnesHutRepulsion=function(){var t,e,n,s;if(v.topleft&&v.bottomright){e=new i(v.bottomright),n=new i(v.topleft),l.init(n,e,u.theta);for(t in c.particles)s=c.particles[t],l.insert(s);for(t in c.particles)s=c.particles[t],l.applyForces(s,u.repulsion)}},this.applySprings=function(){var t,e,n,s,o;for(o in c.springs)t=c.springs[o],e=t.point2.p.subtract(t.point1.p),n=t.length-e.magnitude(),s=(e.magnitude()>0?e:i.random(1)).normalize(),t.point1.applyForce(s.multiply(t.k*n*-.5)),t.point2.applyForce(s.multiply(t.k*n*.5))},this.applyCenterDrift=function(){var t,e,n,s=0,o=new i(0,0);for(e in c.particles)n=c.particles[e],o.add(n.p),s++;if(0!==s){t=o.divide(-s);for(e in c.particles)n=c.particles[e],n.applyForce(t)}},this.applyCenterGravity=function(){var t,e,i;for(t in c.particles)i=c.particles[t],e=i.p.multiply(-1),i.applyForce(e.multiply(u.repulsion/100))},this.updateVelocity=function(t){var e,n,s,o,r=1e3,a=0,d=0,p=0;for(o in c.particles)s=c.particles[o],s.fixed?(s.v=new i(0,0),s.f=new i(0,0)):(s.v="euler"===u.integrator?s.v.add(s.f.multiply(t)).multiply(1-u.friction):s.v.add(s.f.add(s._F.divide(s.m)).multiply(.5*t)).multiply(1-u.friction),s.f.x=s.f.y=0,e=s.v.magnitude(),e>r&&(s.v=s.v.divide(e*e)),e=s.v.magnitude(),n=e*e,a+=n,d=Math.max(n,d),p++);g={sum:a,max:d,mean:a/p,n:p}},this.updatePosition=function(t){var e,n,s,o,r=null,a=null;for(o in c.particles)s=c.particles[o],s.fixed&&(s.v=new i(0,0),s.f=new i(0,0)),"euler"===u.integrator?s.p=s.p.add(s.v.multiply(t)):(n=s.f.multiply(.5*t*t).divide(s.m),s.p=s.p.add(s.v.multiply(t)).add(n)),r?(e=s.p,null!==e.x&&null!==e.y&&(e.x>r.x&&(r.x=e.x),e.y>r.y&&(r.y=e.y),e.x<a.x&&(a.x=e.x),e.y<a.y&&(a.y=e.y))):(r=new i(s.p.x,s.p.y),a=new i(s.p.x,s.p.y));v={topleft:a||new i(-1,-1),bottomright:r||new i(1,1)}},this.systemEnergy=function(){return g}};e.exports=r},{"./BarnesHutTree":4,"./atoms/Particle":10,"./atoms/Point":11,"./atoms/Spring":12}],7:[function(t,e){var i=t("./Physics"),n=function(){{var t=this,e=20,n=null,s=null,o=null;+Date.now()}this.init=function(e){t.timeout(e.timeout),n=new i(e.dt,e.stiffness,e.repulsion,e.friction,t.tock)},this.timeout=function(i){i!==e&&(e=i,null!==s&&(t.stop(),t.start()))},this.start=function(){null===s&&(postMessage({type:"stateChange",value:"running"}),o=null,s=setInterval(t.tick,e))},this.stop=function(){null!==s&&(clearInterval(s),s=null,postMessage({type:"stateChange",value:"paused"}))},this.tick=function(){var e;n.tick(),e=n.systemEnergy(),(e.mean+e.max)/2<.05?(null===o&&(o=+Date.now()),+Date.now()-o>1e3?t.stop():postMessage({type:"stateChange",value:"paused"})):o=null},this.tock=function(t){t.type="geometry",postMessage(t)},this.modifyNode=function(t,e){n.modifyNode(t,e)},this.modifyPhysics=function(t){n.modifyPhysics(t)},this.update=function(t){n._update(t)}};onmessage=function(t){var e;if(t.data.type)switch(t.data.type){case"physics":e=t.data.physics,arbor.physics.init(t.data.physics);break;case"modify":arbor.physics.modifyNode(t.data.id,t.data.mods);break;case"changes":arbor.physics.update(t.data.changes);break;case"start":arbor.physics.start();break;case"stop":arbor.physics.stop();break;case"sys":e=t.data.param||{},isNaN(e.timeout)||arbor.physics.timeout(e.timeout),arbor.physics.modifyPhysics(e)}},e.exports=n},{"./Physics":6}],8:[function(t,e){function i(t,e,i){this._id=n--,this.source=t,this.target=e,this.length=void 0!==i.length?i.length:1,this.data=void 0!==i?i:{}}var n=-1;e.exports=i},{}],9:[function(t,e){function i(t){this._id=s++,this.data=t||{},this._mass=void 0!==t.mass?t.mass:1,this._fixed=t.fixed===!0?!0:!1,this._p=new n("number"==typeof t.x?t.x:null,"number"==typeof t.y?t.y:null),this._dampingFactor=1}var n=t("./Point"),s=1;e.exports=i},{"./Point":11}],10:[function(t,e){function i(t,e,i){void 0===i&&(i=1),this.p=t,this.m=e,this.v=new n(0,0),this.f=new n(0,0),this.d=i}var n=t("./Point");i.prototype.applyForce=function(t){this.f=this.f.add(t.divide(this.m*this.d))},e.exports=i},{"./Point":11}],11:[function(t,e){function i(t,e){t&&t.hasOwnProperty("y")&&(e=t.y,t=t.x),this.x=t,this.y=e}i.random=function(t){return t=void 0!==t?t:5,new i(2*t*(Math.random()-.5),2*t*(Math.random()-.5))},i.prototype={exploded:function(){return isNaN(this.x)||isNaN(this.y)},add:function(t){return new i(this.x+t.x,this.y+t.y)},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},multiply:function(t){return new i(this.x*t,this.y*t)},divide:function(t){return new i(this.x/t,this.y/t)},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normal:function(){return new i(-this.y,this.x)},normalize:function(){return this.divide(this.magnitude())}},e.exports=i},{}],12:[function(t,e){function i(t,e,i,n){this.point1=t,this.point2=e,this.length=i,this.k=n}i.prototype.distanceToParticle=function(t){var e,i;return e=that.point2.p.subtract(that.point1.p).normalize().normal(),i=t.p.subtract(that.point1.p),Math.abs(i.x*e.x+i.y*e.y)},e.exports=i},{}]},{},[3])(3)});